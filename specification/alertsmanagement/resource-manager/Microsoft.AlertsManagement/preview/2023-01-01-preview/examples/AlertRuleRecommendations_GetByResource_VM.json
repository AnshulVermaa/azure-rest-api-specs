{
    "parameters": {
        "resourceUri": "subscriptions/2f00cc51-6809-498f-9ffc-48c42aff570d/resourcegroups/test/providers/Microsoft.Compute/virtualMachines/testMachineCanBeSafelyDeleted",
        "api-version": "2023-01-01-preview"
    },
    "responses": {
        "200":{
            "body": {
                "requestedTargetType": "microsoft.compute/virtualmachines",
                "displayInformation": [
                    {
                        "infoBallonMessage":"Rule1 InfoBalloon Message",
                        "infoBallonLink": "Rule1 InfoBalloon Link",
                        "metricAlertsDisplayInformation": {
                            "metricDisplayName": "Percentage CPU",
                            "displayUnits": "%"
                        }
                    },
                    {
                        "infoBallonMessage":"Rule2 InfoBalloon Message",
                        "infoBallonLink": "Rule2 InfoBalloon Link",
                        "metricAlertsDisplayInformation": {
                            "metricDisplayName": "Available Memory Bytes",
                            "displayUnits": "GB"
                        }
                    }
                ],
                "rulesArmTemplate": {
                    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
                    "contentVersion": "1.0.0.0",
                    "parameters": {
                        "targetResourceId": {
                            "type": "string",
                            "defaultValue": "/subscriptions/2f00cc51-6809-498f-9ffc-48c42aff570d/resourcegroups/test/providers/Microsoft.Compute/virtualMachines/testMachineCanBeSafelyDeleted"
                        },
                        "targetResourceName": {
                            "type": "string",
                            "defaultValue": "testmachinecanbesafelydeleted"
                        },
                        "actionGroupIds": {
                            "type": "array",
                            "defaultValue": [],
                            "metadata": {
                                "description": "Insert Action groups ids to attach them to the below alert rules."
                            }
                        },
                        "alertNamePrefix_0": {
                            "type": "string",
                            "defaultValue": "Percentage CPU",
                            "minLength": 1,
                            "metadata": {
                                "description": "prefix of the alert rule name"
                            }
                        },
                        "alertName_0": {
                            "type": "string",
                            "defaultValue": "[concat('parameters('alertNamePrefix_0'), ' - ', parameters('targetResourceName'))]",
                            "minLength": 1,
                            "metadata": {
                                "description": "Name of the alert rule"
                            }
                        },
                        "alertSeverity_0": {
                            "type": "int",
                            "allowedValues": [
                                0,
                                1,
                                2,
                                3,
                                4
                            ],
                            "defaultValue": 3,
                            "metadata": {
                                "description": "Severity of alert {0,1,2,3,4}"
                            }
                        },
                        "threshold_0": {
                            "type": "int",
                            "defaultValue": 80,
                            "metadata": {
                                "description": "The threshold value at which the alert is activated."
                            }
                        },
                        "alertNamePrefix_1": {
                            "type": "string",
                            "defaultValue": "Available Memory Bytes",
                            "minLength": 1,
                            "metadata": {
                                "description": "prefix of the alert rule name"
                            }
                        },
                        "alertName_1": {
                            "type": "string",
                            "defaultValue": "[concat('parameters('alertNamePrefix_1'), ' - ', parameters('targetResourceName'))]",
                            "minLength": 1,
                            "metadata": {
                                "description": "Name of the alert rule"
                            }
                        },
                        "alertSeverity_1": {
                            "type": "int",
                            "allowedValues": [
                                0,
                                1,
                                2,
                                3,
                                4
                            ],
                            "defaultValue": 3,
                            "metadata": {
                                "description": "Severity of alert {0,1,2,3,4}"
                            }
                        },
                        "threshold_1": {
                            "type": "int",
                            "defaultValue": 1000000000,
                            "metadata": {
                                "description": "The threshold value at which the alert is activated."
                            }
                        }
                    },
                    "variables": {
                        "scopes": "[array(parameters('targetResourceId'))]",
                        "copy": [
                            {
                                "name": "actionsForMetricAlerts",
                                "count": "[length(parameters('actionGroupIds'))]",
                                "input": {
                                    "actiongroupId": "[parameters('actionGroupIds')[copyIndex('actionsForMetricAlerts')]]"
                                }
                            }
                        ]
                    },
                    "resources": [
                        {
                            "name": "[parameters('alertName_0')]",
                            "type": "Microsoft.Insights/metricAlerts",
                            "apiVersion": "2018-03-01",
                            "location": "global",
                            "properties": {
                                "description": "Percentage CPU is greater than 80 %",
                                "severity": "[parameters('alertSeverity_0')]",
                                "enabled": true,
                                "scopes": "[variables('scopes')]",
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT5M",
                                "criteria": {
                                    "odata.type": "Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria",
                                    "allOf": [
                                        {
                                            "name": "Metric1",
                                            "metricName": "Percentage CPU",
                                            "operator": "GreaterThan",
                                            "threshold": "[parameters('threshold_0')]",
                                            "timeAggregation": "Average"
                                        }
                                    ]
                                },
                                "actions": "[variables('actionsForMetricAlerts')]"
                            }
                        },
                        {
                            "name": "[parameters('alertName_1')]",
                            "type": "Microsoft.Insights/metricAlerts",
                            "apiVersion": "2018-03-01",
                            "location": "global",
                            "properties": {
                                "description": "Available Memory Bytes is less than 1 GB",
                                "severity": "[parameters('alertSeverity_1')]",
                                "enabled": true,
                                "scopes": "[variables('scopes')]",
                                "evaluationFrequency": "PT5M",
                                "windowSize": "PT5M",
                                "criteria": {
                                    "odata.type": "Microsoft.Azure.Monitor.MultipleResourceMultipleMetricCriteria",
                                    "allOf": [
                                        {
                                            "name": "Metric1",
                                            "metricName": "Available Memory Bytes",
                                            "operator": "LessThan",
                                            "threshold": "[parameters('threshold_1')]",
                                            "timeAggregation": "Average"
                                        }
                                    ]
                                },
                                "actions": "[variables('actionsForMetricAlerts')]"
                            }
                        }
                    ]
                }
            }
        }
    }
}